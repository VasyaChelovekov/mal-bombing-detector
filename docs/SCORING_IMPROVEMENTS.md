# –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –æ—Ü–µ–Ω–∫–∏ –∏ –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏](#—Ç–µ–∫—É—â–∞—è-—Å–∏—Å—Ç–µ–º–∞-–æ—Ü–µ–Ω–∫–∏)
2. [–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
3. [–ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π](#–ø–ª–∞–Ω-—É–ª—É—á—à–µ–Ω–∏–π)
4. [–î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è](#–¥–µ—Ç–∞–ª—å–Ω—ã–µ-–∏–∑–º–µ–Ω–µ–Ω–∏—è)
5. [–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è](#–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è)

---

## –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç—Ä–∏–∫

–¢–µ–∫—É—â–∏–π `bombing_score` (0-100) —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞ –ø—è—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

| –ú–µ—Ç—Ä–∏–∫–∞ | –í–µ—Å | –§–æ—Ä–º—É–ª–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------------------|----------|
| **ones_zscore** | 35% | `min(100, zscore * 25)` | Z-score –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è % –µ–¥–∏–Ω–∏—Ü –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ |
| **spike_anomaly** | 20% | `min(100, max(0, (ratio - 1.5) * 20))` | –û—Ç–Ω–æ—à–µ–Ω–∏–µ 1-–æ–∫ –∫ 2-–∫–∞–º |
| **distribution_effect** | 20% | `min(100, effect_size * 80)` | Cohen's d –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |
| **bimodality** | 15% | `coef * 100` –µ—Å–ª–∏ bimodal, –∏–Ω–∞—á–µ `coef * 30` | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –±–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏ |
| **entropy_deficit** | 10% | `min(100, deficit * 300)` | –î–µ—Ñ–∏—Ü–∏—Ç —ç–Ω—Ç—Ä–æ–ø–∏–∏ |

### –û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–µ–π—Ç–∏–Ω–≥–∞

```yaml
elite (9.0+):      mean=0.4%, std=0.25%, max_natural=1.2%
excellent (8.5-9): mean=0.7%, std=0.35%, max_natural=1.8%
great (8.0-8.5):   mean=1.2%, std=0.5%,  max_natural=2.8%
good (7.5-8.0):    mean=2.0%, std=0.8%,  max_natural=4.5%
average (<7.5):    mean=3.5%, std=1.2%,  max_natural=7.0%
```

### –ü–æ—Ä–æ–≥–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

| –£—Ä–æ–≤–µ–Ω—å | –î–∏–∞–ø–∞–∑–æ–Ω —Å–∫–æ—Ä–∞ |
|---------|----------------|
| üî¥ CRITICAL | ‚â•75 |
| üü† HIGH | 55-74 |
| üü° MEDIUM | 35-54 |
| üü¢ LOW | <35 |

---

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –õ–æ–∂–Ω–æ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞ –º–µ–≥–∞-–ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∞–Ω–∏–º–µ

**–ü—Ä–∏–º–µ—Ä:** Sousou no Frieren (52991)
- `ones_percentage`: **0.99%** (–æ—á–µ–Ω—å –Ω–∏–∑–∫–æ!)
- `tens_percentage`: **55.55%** (–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ)
- `bombing_score`: **71.26** (HIGH)

**–ü—Ä–∏—á–∏–Ω–∞:** 
- –í—ã—Å–æ–∫–∏–π `distribution_effect_size` (1.012) –∏–∑-–∑–∞ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ 10-–∫–∞—Ö
- –í—ã—Å–æ–∫–∏–π `spike_ratio` (8.25) ‚Äî –Ω–æ 1-–æ–∫ –≤—Å–µ–≥–æ 0.99%!

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ –ø—É—Ç–∞–µ—Ç **–ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å** (–º–Ω–æ–≥–æ 10-–æ–∫) —Å **–±–æ–º–±–∏–Ω–≥–æ–º** (–º–Ω–æ–≥–æ 1-–æ–∫).

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Gintama-—ç—Ñ—Ñ–µ–∫—Ç (—Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ)

6 –∏–∑ 8 –∞–Ω–∏–º–µ —Å —É—Ä–æ–≤–Ω–µ–º CRITICAL ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ —Å–µ–∑–æ–Ω—ã Gintama:
- Gintama: The Final (87.35)
- Gintama¬∞ (77.48)
- Gintama' (77.40)
- Gintama': Enchousen (77.94)
- Gintama. (70.62)
- Gintama. Shirogane no Tamashii-hen (59.22)

**–ü—Ä–∏—á–∏–Ω–∞:**
- –§–∞–Ω–∞—Ç—ã Gintama –∏–∑–≤–µ—Å—Ç–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞—â–∏—Ç–æ–π —Ä–µ–π—Ç–∏–Ω–≥–∞
- –≠—Ç–æ —Å–∫–æ—Ä–µ–µ **–ø–æ–ª—è—Ä–∏–∑–∞—Ü–∏—è** (10 vs 1), –∞ –Ω–µ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ç–∞–∫–∞

**–í—ã–≤–æ–¥:** –ù—É–∂–Ω–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å **–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫—É—é –ø–æ–ª—è—Ä–∏–∑–∞—Ü–∏—é** –∏ **–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ–º–±–∏–Ω–≥**.

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è spike_ratio

–¢–µ–∫—É—â–∞—è —Ñ–æ—Ä–º—É–ª–∞: `spike_score = min(100, max(0, (spike_ratio - 1.5) * 20))`

–ü—Ä–∏ `spike_ratio = 6.5`:
- `spike_score = (6.5 - 1.5) * 20 = 100` ‚Üí –º–∞–∫—Å–∏–º—É–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç

–ù–æ –ø—Ä–∏ `ones_percentage = 0.5%` –∏ `twos_percentage = 0.08%`:
- `spike_ratio = 0.5 / 0.08 = 6.25` ‚Üí –≤—ã—Å–æ–∫–∏–π ratio –ø—Ä–∏ –º–∏–Ω–∏–º—É–º–µ –≥–æ–ª–æ—Å–æ–≤!

**–í—ã–≤–æ–¥:** `spike_ratio` –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ 1-–æ–∫.

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Bimodality –∫–∞–∫ –ª–æ–∂–Ω—ã–π —Å–∏–≥–Ω–∞–ª

–î–ª—è —Ç–æ–ø–æ–≤—ã—Ö –∞–Ω–∏–º–µ –≤—ã—Å–æ–∫–∞—è –±–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî **–Ω–æ—Ä–º–∞**, –∞ –Ω–µ –ø—Ä–∏–∑–Ω–∞–∫ –±–æ–º–±–∏–Ω–≥–∞:
- –ú–Ω–æ–≥–æ 10-–æ–∫ (—Ñ–∞–Ω–∞—Ç—ã) + –Ω–µ–º–Ω–æ–≥–æ 1-–æ–∫ (—Ö–µ–π—Ç–µ—Ä—ã) = –±–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å
- –≠—Ç–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–ª—è—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö:
```json
"context": {
  "anime_age_years": 0.0,      // –ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
  "total_members": 0,          // –ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
  "popularity_tier": "mega_popular",
  "content_type": "unknown"    // –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
}
```

`adjusted_score` –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–≤–µ–Ω `bombing_score` ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è.

### –ü—Ä–æ–±–ª–µ–º–∞ 6: Distribution effect size –∏–∑–º–µ—Ä—è–µ—Ç –Ω–µ —Ç–æ

Cohen's d —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –Ω–∞–±–ª—é–¥–∞–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å "–æ–∂–∏–¥–∞–µ–º—ã–º", –Ω–æ:
- –û–∂–∏–¥–∞–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Äî –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- –û–Ω–æ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∞–Ω–∏–º–µ –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
- –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤ —Å—Ç–æ—Ä–æ–Ω—É 10-–æ–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç effect size —Ç–∞–∫ –∂–µ, –∫–∞–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤ —Å—Ç–æ—Ä–æ–Ω—É 1-–æ–∫

---

## –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 1.1 –í–≤–µ—Å—Ç–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ ones_percentage –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π

```python
# –í _classify_level() –¥–æ–±–∞–≤–∏—Ç—å:
MIN_ONES_FOR_CRITICAL = 2.0  # –ú–∏–Ω–∏–º—É–º 2% –µ–¥–∏–Ω–∏—Ü –¥–ª—è CRITICAL
MIN_ONES_FOR_HIGH = 1.5      # –ú–∏–Ω–∏–º—É–º 1.5% –µ–¥–∏–Ω–∏—Ü –¥–ª—è HIGH

if ones_pct < MIN_ONES_FOR_CRITICAL and score >= thresholds.critical:
    return SuspicionLevel.HIGH  # –ü–æ–Ω–∏–∂–∞–µ–º —É—Ä–æ–≤–µ–Ω—å

if ones_pct < MIN_ONES_FOR_HIGH and score >= thresholds.high:
    return SuspicionLevel.MEDIUM  # –ü–æ–Ω–∏–∂–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
```

#### 1.2 –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å spike_ratio —Å —É—á—ë—Ç–æ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```python
def calculate_spike_ratio(distribution: Dict[int, float]) -> float:
    ones = distribution.get(1, 0)
    twos = distribution.get(2, 0)
    
    # –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞: spike –∑–Ω–∞—á–∏–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º % –µ–¥–∏–Ω–∏—Ü
    if ones < 0.5:  # –ú–µ–Ω–µ–µ 0.5% –µ–¥–∏–Ω–∏—Ü ‚Äî spike –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
        return 0.0
    
    if twos < 0.1:
        return min(ones * 3, 10.0)  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º
    
    raw_ratio = ones / twos
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –¥–ª—è –º–∞–ª–æ–≥–æ % –µ–¥–∏–Ω–∏—Ü
    weight = min(1.0, ones / 2.0)  # –ü–æ–ª–Ω—ã–π –≤–µ—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ ones >= 2%
    return raw_ratio * weight
```

#### 1.3 –î–æ–±–∞–≤–∏—Ç—å "popularity penalty" –¥–ª—è effect_size

```python
def _calculate_effect_size(self, distribution, anime_score):
    expected = get_expected_distribution(anime_score)
    raw_effect = self.effect_calc.calculate_cohens_d(distribution, expected)
    
    # Penalty: –µ—Å–ª–∏ –º–Ω–æ–≥–æ 10-–æ–∫ –∏ –º–∞–ª–æ 1-–æ–∫ ‚Äî —ç—Ç–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å, –Ω–µ –±–æ–º–±–∏–Ω–≥
    tens_pct = distribution.get(10, 0)
    ones_pct = distribution.get(1, 0)
    
    if tens_pct > 45 and ones_pct < 1.5:
        # –í—ã—Å–æ–∫–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å, –Ω–∏–∑–∫–∏–π –±–æ–º–±–∏–Ω–≥ ‚Äî —É–º–µ–Ω—å—à–∞–µ–º effect
        popularity_discount = 0.5
        return raw_effect * popularity_discount
    
    return raw_effect
```

### –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 2.1 –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π effect size (—Ñ–æ–∫—É—Å –Ω–∞ 1-–∫–∞—Ö)

–¢–µ–∫—É—â–∏–π Cohen's d –æ–¥–∏–Ω–∞–∫–æ–≤–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö.
–ù—É–∂–µ–Ω **–∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π** –≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–æ–ª—å—à–µ —à—Ç—Ä–∞—Ñ—É–µ—Ç –∑–∞ –∏–∑–±—ã—Ç–æ–∫ 1-–æ–∫:

```python
def calculate_bombing_focused_effect(observed, expected):
    """Effect size —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –Ω–∏–∑–∫–∏—Ö –æ—Ü–µ–Ω–∫–∞—Ö."""
    # –í–µ—Å–∞: 1-–∫–∏ –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ, 2-4 ‚Äî —É–º–µ—Ä–µ–Ω–Ω–æ, 5+ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ
    weights = {1: 3.0, 2: 2.0, 3: 1.5, 4: 1.2, 5: 1.0, 
               6: 0.8, 7: 0.5, 8: 0.3, 9: 0.2, 10: 0.1}
    
    weighted_diff = 0
    total_weight = sum(weights.values())
    
    for score in range(1, 11):
        obs = observed.get(score, 0)
        exp = expected.get(score, 0)
        diff = obs - exp
        # –¢–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –≤ –Ω–∏–∑–∫–∏—Ö –æ—Ü–µ–Ω–∫–∞—Ö
        if score <= 4 and diff > 0:
            weighted_diff += diff * weights[score]
        elif score > 4 and diff < 0:
            # –î–µ—Ñ–∏—Ü–∏—Ç –≤—ã—Å–æ–∫–∏—Ö –æ—Ü–µ–Ω–æ–∫ ‚Äî –º–µ–Ω–µ–µ –≤–∞–∂–µ–Ω
            weighted_diff += abs(diff) * weights[score] * 0.3
    
    return weighted_diff / total_weight
```

#### 2.2 –í–≤–µ—Å—Ç–∏ "Polarization Score" –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç "Bombing Score"

–°–æ–∑–¥–∞—Ç—å –¥–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ß—Ç–æ –∏–∑–º–µ—Ä—è–µ—Ç |
|---------|--------------|
| **Bombing Score** | –ê–Ω–æ–º–∞–ª—å–Ω—ã–π –∏–∑–±—ã—Ç–æ–∫ 1-–æ–∫ (–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ç–∞–∫–∞) |
| **Polarization Score** | –ü—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ 10-–æ–∫ –∏ 1-–æ–∫ (–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç) |

```python
@dataclass
class DualScoreMetrics:
    bombing_score: float      # –§–æ–∫—É—Å –Ω–∞ 1-–∫–∞—Ö
    polarization_score: float # 10s vs 1s
    combined_risk: float      # –í–∑–≤–µ—à–µ–Ω–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
```

#### 2.3 –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ–∂–∏–¥–∞–µ–º—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–í–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ:

```python
class AdaptiveExpectations:
    """–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏."""
    
    def __init__(self, reference_data: List[AnimeData]):
        # –°—Ç—Ä–æ–∏–º —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–µ–π—Ç–∏–Ω–≥–∞
        self.distributions = self._build_from_reference(reference_data)
    
    def get_expected(self, score: float, popularity: int) -> Dict[int, float]:
        category = self._get_category(score)
        pop_tier = self._get_popularity_tier(popularity)
        return self.distributions[category][pop_tier]
```

### –§–∞–∑–∞ 3: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### 3.1 –í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑

–ë–æ–º–±–∏–Ω–≥ –æ–±—ã—á–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **—Ä–µ–∑–∫–æ** ‚Äî –º–Ω–æ–≥–æ 1-–æ–∫ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥.
–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:

```python
def detect_temporal_anomaly(vote_history: List[VoteSnapshot]) -> float:
    """–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–µ–∑–∫–∏—Ö –≤—Å–ø–ª–µ—Å–∫–æ–≤ 1-–æ–∫."""
    # –ê–Ω–∞–ª–∏–∑ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è % –µ–¥–∏–Ω–∏—Ü
    derivatives = []
    for i in range(1, len(vote_history)):
        delta_ones = vote_history[i].ones_pct - vote_history[i-1].ones_pct
        delta_time = (vote_history[i].timestamp - vote_history[i-1].timestamp).days
        if delta_time > 0:
            derivatives.append(delta_ones / delta_time)
    
    # –†–µ–∑–∫–∏–π —Ä–æ—Å—Ç ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ –±–æ–º–±–∏–Ω–≥–∞
    max_spike = max(derivatives) if derivatives else 0
    return min(100, max_spike * 50)
```

#### 3.2 –ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å "—Å–æ—Å–µ–¥—è–º–∏" –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏:

```python
def calculate_peer_deviation(anime: AnimeData, peers: List[AnimeData]) -> float:
    """–ù–∞—Å–∫–æ–ª—å–∫–æ –∞–Ω–∏–º–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø–æ—Ö–æ–∂–∏—Ö."""
    peer_ones = [p.distribution.ones_percentage for p in peers]
    mean_ones = np.mean(peer_ones)
    std_ones = np.std(peer_ones)
    
    if std_ones == 0:
        return 0.0
    
    return (anime.distribution.ones_percentage - mean_ones) / std_ones
```

#### 3.3 –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ)

–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —Å–ª—É—á–∞–∏ –±–æ–º–±–∏–Ω–≥–∞):

```python
from sklearn.ensemble import RandomForestClassifier

class MLBombingDetector:
    def __init__(self, labeled_data):
        self.model = RandomForestClassifier(n_estimators=100)
        X = self._extract_features(labeled_data)
        y = [d.is_bombed for d in labeled_data]
        self.model.fit(X, y)
    
    def predict_probability(self, anime: AnimeData) -> float:
        features = self._extract_features([anime])
        return self.model.predict_proba(features)[0][1]
```

---

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/core/metrics.py`

```python
# 1. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
MIN_ONES_PCT_FOR_CRITICAL = 2.0
MIN_ONES_PCT_FOR_HIGH = 1.5
POPULARITY_DISCOUNT_THRESHOLD_TENS = 45.0
POPULARITY_DISCOUNT_THRESHOLD_ONES = 1.5
POPULARITY_DISCOUNT_FACTOR = 0.5

# 2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å _calculate_metric_scores()
def _calculate_metric_scores(self, ...):
    weights = self.config.analysis.metric_weights
    
    # –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è spike_score —Å –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º
    if ones_pct < 0.5:
        spike_score = 0  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º spike –ø—Ä–∏ –º–∏–∑–µ—Ä–Ω–æ–º % –µ–¥–∏–Ω–∏—Ü
    else:
        ones_weight = min(1.0, ones_pct / 2.0)
        raw_spike = min(100, max(0, (spike_ratio - 1.5) * 20))
        spike_score = raw_spike * ones_weight
    
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ ...

# 3. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å _classify_level()
def _classify_level(self, score, ones_zscore, ones_pct, spike_ratio):
    thresholds = self.config.analysis.suspicion_thresholds
    
    # –ë–∞–∑–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    if score >= thresholds.critical:
        base_level = SuspicionLevel.CRITICAL
    elif score >= thresholds.high:
        base_level = SuspicionLevel.HIGH
    # ...
    
    # –ü–æ–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø—Ä–∏ –Ω–∏–∑–∫–æ–º % –µ–¥–∏–Ω–∏—Ü
    if base_level == SuspicionLevel.CRITICAL and ones_pct < MIN_ONES_PCT_FOR_CRITICAL:
        return SuspicionLevel.HIGH
    if base_level == SuspicionLevel.HIGH and ones_pct < MIN_ONES_PCT_FOR_HIGH:
        return SuspicionLevel.MEDIUM
    
    return base_level

# 4. –î–æ–±–∞–≤–∏—Ç—å popularity discount –≤ effect size
def _calculate_effect_size(self, distribution, anime_score):
    expected = get_expected_distribution(anime_score)
    raw_effect = self.effect_calc.calculate_cohens_d(distribution, expected)
    
    tens_pct = distribution.get(10, 0)
    ones_pct = distribution.get(1, 0)
    
    # –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å ‚â† –±–æ–º–±–∏–Ω–≥
    if tens_pct > POPULARITY_DISCOUNT_THRESHOLD_TENS and \
       ones_pct < POPULARITY_DISCOUNT_THRESHOLD_ONES:
        return raw_effect * POPULARITY_DISCOUNT_FACTOR
    
    return raw_effect
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/core/statistics.py`

```python
# –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å calculate_spike_ratio()
@staticmethod
def calculate_spike_ratio(distribution: Dict[int, float]) -> float:
    ones = distribution.get(1, 0)
    twos = distribution.get(2, 0)
    
    # Spike –∑–Ω–∞—á–∏–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º % –µ–¥–∏–Ω–∏—Ü
    if ones < 0.5:
        return 0.0
    
    if twos < 0.1:
        return min(ones * 3, 10.0)
    
    raw_ratio = ones / twos
    
    # –ó–∞—Ç—É—Ö–∞–Ω–∏–µ –¥–ª—è –º–∞–ª–æ–≥–æ % –µ–¥–∏–Ω–∏—Ü
    weight = min(1.0, ones / 2.0)
    return raw_ratio * weight
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `config/config.example.yaml`

```yaml
analysis:
  # –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
  bombing_score_adjustments:
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π % –µ–¥–∏–Ω–∏—Ü –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π
    min_ones_for_critical: 2.0
    min_ones_for_high: 1.5
    
    # Popularity discount
    popularity_discount:
      enabled: true
      tens_threshold: 45.0
      ones_threshold: 1.5
      discount_factor: 0.5
    
    # Spike ratio damping
    spike_damping:
      enabled: true
      min_ones_for_full_weight: 2.0
      min_ones_to_consider: 0.5
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è

| ‚Ññ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ |
|---|-----------|-----------|-----------|---------|
| 1 | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ ones_pct –¥–ª—è —É—Ä–æ–≤–Ω–µ–π | üî¥ –í—ã—Å–æ–∫–∏–π | –ù–∏–∑–∫–∞—è | –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –≥–ª–∞–≤–Ω—ã–µ FP |
| 2 | Popularity discount –¥–ª—è effect_size | üî¥ –í—ã—Å–æ–∫–∏–π | –ù–∏–∑–∫–∞—è | –£—Å—Ç—Ä–∞–Ω—è–µ—Ç Frieren-—ç—Ñ—Ñ–µ–∫—Ç |
| 3 | –ó–∞—Ç—É—Ö–∞–Ω–∏–µ spike_ratio –ø—Ä–∏ –Ω–∏–∑–∫–æ–º ones_pct | üî¥ –í—ã—Å–æ–∫–∏–π | –ù–∏–∑–∫–∞—è | –¢–æ—á–Ω—ã–π spike |
| 4 | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | üü† –°—Ä–µ–¥–Ω–∏–π | –°—Ä–µ–¥–Ω—è—è | –õ—É—á—à–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å |
| 5 | –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π effect size | üü† –°—Ä–µ–¥–Ω–∏–π | –°—Ä–µ–¥–Ω—è—è | –§–æ–∫—É—Å –Ω–∞ 1-–∫–∞—Ö |
| 6 | Polarization Score –æ—Ç–¥–µ–ª—å–Ω–æ | üü° –ù–∏–∑–∫–∏–π | –í—ã—Å–æ–∫–∞—è | –ù–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ |
| 7 | –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è | üü° –ù–∏–∑–∫–∏–π | –í—ã—Å–æ–∫–∞—è | –¢—Ä–µ–±—É–µ—Ç –¥–∞–Ω–Ω—ã—Ö |
| 8 | –í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑ | ‚ö™ –ë—É–¥—É—â–µ–µ | –í—ã—Å–æ–∫–∞—è | –¢—Ä–µ–±—É–µ—Ç API |
| 9 | ML-–º–æ–¥–µ–ª—å | ‚ö™ –ë—É–¥—É—â–µ–µ | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | –¢—Ä–µ–±—É–µ—Ç —Ä–∞–∑–º–µ—Ç–∫—É |

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –§–∞–∑—ã 1

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –ê–Ω–∏–º–µ | ones_pct | bombing_score | level |
|-------|----------|---------------|-------|
| Frieren | 0.99% | 71.26 | HIGH |
| FMA:B | 2.21% | 81.21 | CRITICAL |
| Death Note | 0.19% | 10.01 | LOW |

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø—Ä–æ–≥–Ω–æ–∑)

| –ê–Ω–∏–º–µ | ones_pct | bombing_score | level |
|-------|----------|---------------|-------|
| Frieren | 0.99% | ~35-40 | MEDIUM |
| FMA:B | 2.21% | ~70-75 | HIGH |
| Death Note | 0.19% | ~8-10 | LOW |

**–ö–ª—é—á–µ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** Frieren –ø–æ–Ω–∏–∂–µ–Ω —Å HIGH –¥–æ MEDIUM, —Ç–∞–∫ –∫–∞–∫:
1. `ones_pct < 1.5%` ‚Üí –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å HIGH
2. `popularity_discount` –ø—Ä–∏–º–µ–Ω—ë–Ω (tens=55.55%, ones=0.99%)
3. `spike_ratio` –∑–∞—Ç—É—Ö–∞–µ—Ç –∏–∑-–∑–∞ –Ω–∏–∑–∫–æ–≥–æ ones_pct

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö–æ—Ä–æ—à–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç **—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∞–Ω–æ–º–∞–ª–∏–∏**, –Ω–æ –Ω–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç:
- **–ë–æ–º–±–∏–Ω–≥** (–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ç–∞–∫–∞ 1-–∫–∞–º–∏) vs 
- **–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å** (–º–Ω–æ–≥–æ 10-–æ–∫ —Å–æ–∑–¥–∞—ë—Ç –≤—ã—Å–æ–∫–∏–π effect size) vs
- **–ü–æ–ª—è—Ä–∏–∑–∞—Ü–∏—é** (–æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–Ω–µ–Ω–∏–π)

–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –§–∞–∑—ã 1 ‚Äî —ç—Ç–æ **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ, –Ω–µ—Ä–∞–∑—Ä—É—à–∞—é—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**, –∫–æ—Ç–æ—Ä—ã–µ:
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –î–æ–±–∞–≤–ª—è—é—Ç 3 –ø—Ä–æ–≤–µ—Ä–∫–∏/–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞—é—Ç –ª–æ–∂–Ω–æ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –õ–µ–≥–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ YAML
